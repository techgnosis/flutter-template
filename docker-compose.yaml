version: "3.8"

services:
  # 1. The Emulator (The Body)
  # Uses a pre-built image with KVM support for speed
  emulator:
    image: google/docker-android-x86-14.0 # Android 14 Image
    privileged: true
    devices:
      - "/dev/kvm:/dev/kvm"
    environment:
      - EMULATOR_ARGS=-no-window -no-audio -gpu swiftshader_indirect
    networks:
      - flutter-net

  # 2. The ADB Bridge (The Nervous System)
  # Acts as the central hub for all ADB commands
  adb-bridge:
    image: sorccu/adb
    depends_on:
      - emulator
    command: adb -a nodaemon server start
    networks:
      - flutter-net

  # 3. The Dev-Agent (The Brain)
  # This is where your agent writes code and triggers hot reload
  dev-agent:
    build:
      context: .
      dockerfile: Agent.Dockerfile
    volumes:
      - .:/workspace
    environment:
      - ANDROID_ADB_SERVER_ADDRESS=adb-bridge
    depends_on:
      - adb-bridge
    stdin_open: true # Allows the agent to talk to the process
    tty: true
    networks:
      - flutter-net

networks:
  flutter-net:
    driver: bridge
